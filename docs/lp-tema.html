<!doctype html><html lang="pt-BR"><head><meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LLPC • Ver fotos do tema</title>
<style>
:root{--brand:#0f766e;--brand2:#158f80;--bg:#0b1214;--card:#10191b;--text:#e8f1ef;--muted:#9fb6b1}
html,body{background:var(--bg);color:var(--text);margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif}
.wrap{max-width:1120px;margin:24px auto;padding:0 16px}
header{display:flex;align-items:center;gap:12px;margin:8px 0 16px}
header h1{font-size:22px;margin:0;text-transform:capitalize}
.filters{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 16px}
.pill{background:#122325;border:1px solid #1b3135;color:var(--muted);padding:6px 10px;border-radius:999px;cursor:pointer}
.pill.active{background:var(--brand);border-color:var(--brand2);color:#fff}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
.card{background:var(--card);border:1px solid #152326;border-radius:16px;overflow:hidden;display:flex;flex-direction:column}
.imgbox{position:relative;aspect-ratio:1/1;overflow:hidden;background:#0c1517}
.imgbox img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .3s}
.imgbox:hover img{transform:scale(1.02)}
.badge{position:absolute;top:8px;left:8px;background:rgba(0,0,0,.65);color:#fff;padding:6px 10px;border-radius:999px;font-size:12px;border:1px solid rgba(255,255,255,.2)}
.price{position:absolute;bottom:8px;left:8px;background:linear-gradient(135deg,var(--brand),var(--brand2));color:#fff;padding:8px 10px;border-radius:12px;font-weight:700}
.price small{display:block;opacity:.9;font-weight:600;text-decoration:line-through}
.content{padding:12px 12px 14px;display:flex;flex-direction:column;gap:8px}
.desc{color:#d7e7e4;font-size:14px;line-height:1.35;min-height:38px}
.tags{color:#7aa9a1;font-size:12px}
.row{display:flex;gap:8px}
.btn{flex:1;background:#133a37;border:1px solid #24534f;color:#dff5f1;padding:10px 12px;border-radius:10px;text-align:center;text-decoration:none;font-weight:700}
.btn:hover{filter:brightness(1.05)}
.btn.sec{background:#0e1b1d;border-color:#1a3033;color:#b8cfcb}
.muted{color:var(--muted)}
footer{opacity:.7;text-align:center;font-size:12px;margin:22px 0}
.empty{padding:48px 0;text-align:center;color:var(--muted)}
.saving{font-size:12px;color:#b6e3da}
</style></head><body>
<div class="wrap">
  <header>
    <a href="./" style="color:#89c9be;text-decoration:none;font-weight:700">← Temas</a>
    <h1 id="ttl">LLPC • Fotos do tema</h1>
  </header>
  <div class="filters" id="filters"></div>
  <div class="grid" id="grid"></div>
  <div class="empty" id="empty" style="display:none">Nada encontrado para este filtro.</div>
  <footer>LLPC • Laços & Letras Papelaria Criativa</footer>
</div>
<script>
const OWNER='lacosletraspc-maker', REPO='llpc-fotos', BRANCH='main';
const BASE_RAW='https://raw.githubusercontent.com/lacosletraspc-maker/llpc-fotos/main';
const PRECOS_URL = BASE_RAW + '/precos/precos.json';

const qs = new URLSearchParams(location.search);
const tema = qs.get('tema') || 'kit-a-bela-e-a-fera';

const CONFIG = {
  BUNDLE_EXTRA_PCT: 0.08,      // desconto adicional para o kit (conjunto)
  MIN_MARGIN_PCT: 0.35,        // margem mínima global
  DESCONTO_EXIBIR_PCT: 0.15    // desconto para gerar o "DE"
};

const state = { precos:{}, items:[], filtro:'todos' };
function grana(v){ return v==null ? null : Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
function byId(id){ return document.getElementById(id); }

async function boot(){
  byId('ttl').textContent = tema.replaceAll('-',' ');
  const [catRes, preRes] = await Promise.all([ fetch(BASE_RAW+'/catalogo/'+encodeURIComponent(tema)+'.json'), fetch(PRECOS_URL) ]);
  const items = await catRes.json();
  const precosArr = await preRes.json();
  const precos = {}; precosArr.forEach(p => { precos[(p.sku||'').toUpperCase()] = p; });
  state.precos = precos; state.items  = items;
  desenharFiltros(items);
  render();
}
function desenharFiltros(items){
  const linhas = new Set(items.map(it => (it.linha||'').toLowerCase()).filter(Boolean));
  const box = byId('filters'); box.innerHTML = '';
  const pills = [['todos','Todos'], ...[...linhas].sort().map(x=>[x,x.replace('kit ','')])];
  pills.forEach(([val,label])=>{
    const el = document.createElement('button');
    el.className='pill'+(state.filtro===val?' active':'');
    el.textContent=label; el.onclick=()=>{ state.filtro=val; render(); };
    box.appendChild(el);
  });
}
function roundSuffix(v){
  const suf = 0.90;                     // mesmo sufixo do Apps Script (pode ajustar)
  const base = Math.floor(v);
  let out = base + suf;
  if(out < v) out = base + 1 + suf;
  return Math.round(out*100)/100;
}
function priceSingle(it){
  const sku = (it.sku||'').toString().trim().toUpperCase();
  const p = state.precos[sku]; if(!p) return null;
  return { por:p.preco_por, de:p.preco_de, pct: Math.max(0, Math.round((1-p.preco_por/p.preco_de)*100)) };
}
function priceBundle(it){
  const skus = (it.sku||'').toString().toUpperCase().split(';').map(s=>s.trim()).filter(Boolean);
  const found = skus.map(s=>state.precos[s]).filter(Boolean);
  if(!found.length) return null;
  const sumPor  = found.reduce((a,b)=>a+(b.preco_por||0),0);
  const sumCost = found.reduce((a,b)=>a+(b.custo||0),0);

  let por = sumPor * (1 - CONFIG.BUNDLE_EXTRA_PCT);
  const minPor = sumCost * (1 + CONFIG.MIN_MARGIN_PCT);
  if(por < minPor) por = minPor;
  por = roundSuffix(por);

  let de = por/(1 - CONFIG.DESCONTO_EXIBIR_PCT);
  de = roundSuffix(de);
  if(de <= por) de = roundSuffix(por*1.05);

  const save = Math.max(0, sumPor - por);
  const pct  = Math.max(0, Math.round((1 - por/de)*100));
  return { por, de, pct, save, sumPor };
}
function render(){
  const grid = byId('grid'); grid.innerHTML='';
  const empty = byId('empty'); empty.style.display='none';

  let view = state.items.slice();
  if(state.filtro!=='todos'){
    const f = state.filtro.toLowerCase();
    view = view.filter(it => (it.linha||'').toLowerCase().includes(f));
  }
  if(!view.length){ empty.style.display='block'; return; }

  view.forEach(it=>{
    const isConj = (it.tags||'').toLowerCase().includes('conjunto');
    const p = isConj ? priceBundle(it) : priceSingle(it);

    const card = document.createElement('div');
    card.className='card';
    card.innerHTML = `
      <div class="imgbox">
        <img loading="lazy" src="${it.url_jsdelivr}" alt="${it.descricao_curta||''}">
        ${ isConj ? '<div class="badge">Conjunto</div>' : '' }
        ${ p ? '<div class="price"><small>'+grana(p.de)+'</small>'+grana(p.por)+' '+(p.pct?'<span style="font-weight:600">('+p.pct+'% OFF)</span>':'')+'</div>' : '' }
      </div>
      <div class="content">
        <div class="desc">${it.descricao_curta||''}</div>
        ${ isConj && p ? '<div class="saving">Comprando separados sairia por <b>'+grana(p.sumPor)+'</b>. No kit completo sai por <b>'+grana(p.por)+'</b> (economize <b>'+grana(p.save)+'</b>).</div>' : '' }
        <div class="tags">${it.tags||''}</div>
        <div class="row">
          <a class="btn" target="_blank" href="${it.url_whatsapp}">Pedir no WhatsApp</a>
          <a class="btn sec" target="_blank" href="${it.url_jsdelivr}">Abrir imagem</a>
        </div>
      </div>`;
    grid.appendChild(card);
  });
}
boot().catch(err=>{
  byId('grid').innerHTML = '<div class="empty">Erro ao carregar dados.</div>';
  console.error(err);
});
</script></body></html>