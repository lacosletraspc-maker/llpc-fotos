<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>LLPC • Tema</title>
<link rel="stylesheet" href="style.css?v=1762636295139">
</head>
<body>
  <nav class="topbar"><a href="./">← Temas</a></nav>
  <main class="container">
    <h1 id="h1">Tema</h1>
    <div class="tabs" id="tabs"></div>
    <section id="grid" class="grid"></section>
    <footer>LLPC • Laços & Letras Papelaria Criativa</footer>
  </main>
<script>
function qs(s){return document.querySelector(s)}
function qsp(p){return new URLSearchParams(location.search).get(p)||''}
function slugify(s){return (s||'').toLowerCase().normalize('NFD').replace(/[\\u0300-\\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'')}

(async ()=>{
  const slug = qsp('tema') || '';
  const bust='?v=' + Date.now();
  try{
    const [temaRes, precRes] = await Promise.all([
      fetch('catalogo/'+slug+'.json'+bust, {cache:'no-store'}),
      fetch('precos.json'+bust,            {cache:'no-store'})
    ]);
    if(!temaRes.ok) throw new Error('Tema não encontrado');
    const tema = await temaRes.json();
    const prec = precRes.ok ? await precRes.json() : {};
    qs('#h1').textContent = tema.tema || slug;

    // Abas por linha (se existirem)
    const linhas = Array.from(new Set((tema.cards||[]).map(c=>c.linha).filter(Boolean)));
    const tabs = qs('#tabs');
    tabs.innerHTML='';
    const all = document.createElement('button');
    all.className='pill pill-on'; all.textContent='Todos'; all.dataset.f='__all';
    tabs.appendChild(all);
    for(const l of linhas){
      const b=document.createElement('button'); b.className='pill'; b.textContent=l; b.dataset.f=l; tabs.appendChild(b);
    }

    function render(filtro){
      const g = qs('#grid'); g.innerHTML='';
      for(const c of (tema.cards||[])){
        if(filtro && filtro!=='__all' && c.linha!==filtro) continue;
        const imgs = (c.imagens||[]).slice(0, Math.min(7, c.imagens.length||0));
        const de    = c.preco?.de ?? prec[c.sku]?.de ?? '';
        const por   = c.preco?.por ?? prec[c.sku]?.por ?? '';
        const off   = c.preco?.off ?? prec[c.sku]?.off ?? '';
        const card=document.createElement('article');
        card.className='card photo-card';
        card.innerHTML = \`
          <div class="photo-box">
            <img src="\${imgs[0]||''}" alt="">
            <span class="badge">\${off?off+'% OFF':''}</span>
          </div>
          <div class="card-body">
            <h3>\${c.titulo||c.produto||''}</h3>
            <div class="price">\${de?'<s>R$ '+de+'</s>':''} \${por?'<b>R$ '+por+'</b>':''}</div>
            <p class="tags">\${(c.tags||[]).join(', ')}</p>
            <div class="actions">
              <a class="btn" target="_blank" href="\${c.whatsapp||tema.whatsapp||'#'}">Pedir no WhatsApp</a>
              \${imgs[0]?'<a class="btn btn-ghost" target="_blank" href="'+imgs[0]+'">Abrir imagem</a>':''}
            </div>
          </div>\`;
        g.appendChild(card);
      }
    }
    tabs.addEventListener('click', (ev)=>{
      const b=ev.target.closest('button.pill'); if(!b) return;
      for(const x of tabs.querySelectorAll('.pill')) x.classList.remove('pill-on');
      b.classList.add('pill-on');
      render(b.dataset.f);
    });
    render('__all');
  }catch(e){
    qs('#grid').innerHTML = '<p class="empty">Erro ao carregar dados.</p>';
    console.error(e);
  }
})();
</script>
</body>
</html>