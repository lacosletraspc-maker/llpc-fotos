<!doctype html>
<html lang="pt-br">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>LLPC • Tema</title>
<link rel="stylesheet" href="../style.css">
<body>
  <header class="wrap"><h1 id="h1"></h1><p>Clique nos cards para ver fotos e pedir pelo WhatsApp.</p></header>
  <main class="wrap grid" id="grid"></main>
  <script>
  const Q = new URLSearchParams(location.search);
  const slug = Q.get('slug') || (location.pathname.split('/').pop().replace('.html',''));
  const CDN = location.origin + location.pathname.split('/docs/')[0] + '/docs'; // fallback p/ GitHub Pages
  const money = v => v.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

  async function loadJSON(u){ const r = await fetch(u); return r.json(); }
  async function main(){
    const tema = await loadJSON('../catalogo/'+slug+'.json');
    const precos = await loadJSON('../precos.json').catch(()=>({}));
    document.getElementById('h1').textContent = tema.tema;

    // monta grid
    const G = document.getElementById('grid');
    G.innerHTML = '';
    const cards = tema.cards || [];
    for(const c of cards){
      const imgs = c.imagens || [];
      const first = imgs[0] || '';
      // preço via SKU
      const p = (precos[c.sku]||{});
      const de = +p.preco_publico||0, off = +(p.desc_pct||0);
      const por = de ? Math.round(de*(1-off)*100)/100 : 0;

      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        <div class="caro" data-idx="0" data-imgs="${imgs.join('|')}">
          <img src="${first}" alt="">
          ${imgs.length>1?'<button class="nav l" aria-label="anterior">‹</button><button class="nav r" aria-label="próxima">›</button>':''}
          <span class="badge">${imgs.length||0} fotos</span>
        </div>
        <h3>${c.titulo} — ${c.linha} | LLPC</h3>
        ${de?('<div class="price"><span class="de">de '+money(de)+'</span><div class="por">'+money(por)+' ('+Math.round(off*100)+'% OFF)</div></div>'):'<div class="price">Preço sob consulta</div>'}
        <div class="actions">
          <a class="btn" target="_blank" href="https://wa.me/55?text=${encodeURIComponent('Quero '+c.titulo+' — '+c.linha+' (tema: '+tema.tema+')')}">Pedir no WhatsApp</a>
          ${first?('<a class="btn ghost" target="_blank" href="'+first+'">Abrir imagem</a>'):''}
        </div>`;
      G.appendChild(el);
    }

    // carrossel
    G.addEventListener('click', ev=>{
      const b = ev.target.closest('.nav'); if(!b) return;
      const box = b.closest('.caro');
      const imgs = (box.dataset.imgs||'').split('|').filter(Boolean);
      if(!imgs.length) return;
      let i = +box.dataset.idx||0;
      i = b.classList.contains('l') ? (i-1+imgs.length)%imgs.length : (i+1)%imgs.length;
      box.dataset.idx = i;
      box.querySelector('img').src = imgs[i];
    });
  }
  main();
  </script>
</body>
</html>